<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="https://q2.qlogo.cn/headimg_dl?dst_uin=2973517380&spec=5">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºŒå‰æ ‘æ ‘åŠ å¯†æœº</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        h1 { text-align: center; color: #333; }
        .textarea-container { position: relative; }
        textarea { width: 100%; height: 100px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; padding: 10px; }
        .clear-icon { position: absolute; right: 10px; top: 10px; color: #d9534f; font-size: 20px; cursor: pointer; }
        button { margin: 5px; padding: 10px 15px; border: none; border-radius: 5px; background-color: #5cb85c; color: white; cursor: pointer; }
        button:hover { background-color: #4cae4c; }
        .output { margin-top: 20px; padding: 10px; background-color: white; border: 1px solid #ccc; border-radius: 5px; }
        .controls { text-align: center; margin-top: 10px; }
        .copy-icon, .clear-icon { color: #5bc0de; font-size: 20px; cursor: pointer; margin-left: 10px; }
        .output-container { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>äºŒå‰æ ‘æ ‘åŠ å¯†æœº</h1>
    <div class="textarea-container">
        <textarea id="input" placeholder="è¾“å…¥æ˜æ–‡æˆ–å¯†æ–‡..."></textarea>
        <span class="clear-icon" id="clear-icon" onclick="clearText()" title="æ¸…ç©ºæ–‡æœ¬æ¡†">Ã—</span>
    </div>
    <div class="controls">
        <button onclick="encrypt()">åŠ å¯†</button>
        <button onclick="decrypt()">è§£å¯†</button>
        <button onclick="replaceInput()">å°†ç»“æœæ›¿æ¢åˆ°è¾“å…¥æ¡†</button>
    </div>
    <div class="output-container">
        <h2>ç»“æœï¼š</h2>
        <div class="output" id="output"></div>
        <span class="copy-icon" id="copy-icon" onclick="copyResult()" title="å¤åˆ¶ç»“æœ">ğŸ“‹</span>
    </div>

    <script>
        function stringToBinary(str) {
            let bytes = new TextEncoder().encode(str);
            return [...bytes].map(byte => byte.toString(2).padStart(8, '0')).join('');
        }

        function binaryToString(binary) {
            let byteArray = binary.match(/.{8}/g).map(b => parseInt(b, 2));
            return new TextDecoder().decode(new Uint8Array(byteArray));
        }

        function encrypt() {
            let input = document.getElementById('input').value;
            let encoding = /^[\x00-\x7F]*$/.test(input) ? 'ASCII' : 'UTF-8';
            let header = encoding === 'ASCII' ? 'ASCII' : 'UTF8';
            let combined = `${header}#${input}`;
            let binary = stringToBinary(combined);
            let encrypted = binary.replace(/0/g, 'äºŒå‰').replace(/1/g, 'æ ‘æ ‘');
            document.getElementById('output').innerText = encrypted;
        }

        function decrypt() {
            let input = document.getElementById('input').value;
            let binary = input.replace(/äºŒå‰/g, '0').replace(/æ ‘æ ‘/g, '1');

            try {
                let decodedBinary = binaryToString(binary);
                let [header, originalText] = decodedBinary.split('#');
                document.getElementById('output').innerText = `${header}:\n${originalText}`;
            } catch (e) {
                document.getElementById('output').innerText = 'è§£å¯†å¤±è´¥ï¼šæ•°æ®æŸåæˆ–ç¼–ç é”™è¯¯';
            }
        }

        function clearText() {
            document.getElementById('input').value = '';
            document.getElementById('output').innerText = '';
            showSuccessIcon('clear-icon', 'Ã—', '#d9534f'); // çº¢è‰²
        }

        function copyResult() {
            let output = document.getElementById('output').innerText;
            navigator.clipboard.writeText(output).then(() => {
                showSuccessIcon('copy-icon', 'ğŸ“‹', '#5bc0de'); // é»˜è®¤é¢œè‰²
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥ï¼š', err);
            });
        }

        function replaceInput() {
            let output = document.getElementById('output').innerText;
            document.getElementById('input').value = output;
        }

        function showSuccessIcon(iconId, originalIcon, color) {
            const icon = document.getElementById(iconId);
            icon.innerText = 'âœ”ï¸'; // æ˜¾ç¤ºå‹¾å·
            icon.style.color = '#5cb85c'; // è®¾ç½®é¢œè‰²ä¸ºç»¿è‰²
            setTimeout(() => {
                icon.innerText = originalIcon; // æ¢å¤ä¸ºåŸæ¥çš„å›¾æ ‡
                icon.style.color = color; // æ¢å¤é¢œè‰²
            }, 2000); // 2ç§’åæ¢å¤
        }
    </script>
</body>
</html>
